<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=GBK" http-equiv="Content-Type" />

  <title>File: API_CHANGES.rdoc [sqlite3-1.3.11-x86-mingw32 Documentation]</title>

  <link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet" />

  <script src="./js/jquery.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="./js/thickbox-compressed.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="./js/quicksearch.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="./js/darkfish.js" type="text/javascript"
    charset="utf-8"></script>
</head>

<body class="file">
  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="./index.html">Home</a>
          <a href="./index.html#classes">Classes</a>
          <a href="./index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="./API_CHANGES_rdoc.html">API_CHANGES.rdoc</a></li>
        
          <li class="file"><a href="./CHANGELOG_rdoc.html">CHANGELOG.rdoc</a></li>
        
          <li class="file"><a href="./Manifest_txt.html">Manifest.txt</a></li>
        
          <li class="file"><a href="./README_rdoc.html">README.rdoc</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class Index
          <span class="search-toggle"><img src="./images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="./SQLite3.html">SQLite3</a></li>
        
          <li><a href="./SQLite3/AbortException.html">SQLite3::AbortException</a></li>
        
          <li><a href="./SQLite3/AuthorizationException.html">SQLite3::AuthorizationException</a></li>
        
          <li><a href="./SQLite3/Backup.html">SQLite3::Backup</a></li>
        
          <li><a href="./SQLite3/Blob.html">SQLite3::Blob</a></li>
        
          <li><a href="./SQLite3/BusyException.html">SQLite3::BusyException</a></li>
        
          <li><a href="./SQLite3/CantOpenException.html">SQLite3::CantOpenException</a></li>
        
          <li><a href="./SQLite3/Constants.html">SQLite3::Constants</a></li>
        
          <li><a href="./SQLite3/Constants/ColumnType.html">SQLite3::Constants::ColumnType</a></li>
        
          <li><a href="./SQLite3/Constants/ErrorCode.html">SQLite3::Constants::ErrorCode</a></li>
        
          <li><a href="./SQLite3/Constants/TextRep.html">SQLite3::Constants::TextRep</a></li>
        
          <li><a href="./SQLite3/ConstraintException.html">SQLite3::ConstraintException</a></li>
        
          <li><a href="./SQLite3/CorruptException.html">SQLite3::CorruptException</a></li>
        
          <li><a href="./SQLite3/Database.html">SQLite3::Database</a></li>
        
          <li><a href="./SQLite3/Database/FunctionProxy.html">SQLite3::Database::FunctionProxy</a></li>
        
          <li><a href="./SQLite3/EmptyException.html">SQLite3::EmptyException</a></li>
        
          <li><a href="./SQLite3/Exception.html">SQLite3::Exception</a></li>
        
          <li><a href="./SQLite3/FormatException.html">SQLite3::FormatException</a></li>
        
          <li><a href="./SQLite3/FullException.html">SQLite3::FullException</a></li>
        
          <li><a href="./SQLite3/IOException.html">SQLite3::IOException</a></li>
        
          <li><a href="./SQLite3/InternalException.html">SQLite3::InternalException</a></li>
        
          <li><a href="./SQLite3/InterruptException.html">SQLite3::InterruptException</a></li>
        
          <li><a href="./SQLite3/LockedException.html">SQLite3::LockedException</a></li>
        
          <li><a href="./SQLite3/MemoryException.html">SQLite3::MemoryException</a></li>
        
          <li><a href="./SQLite3/MismatchException.html">SQLite3::MismatchException</a></li>
        
          <li><a href="./SQLite3/MisuseException.html">SQLite3::MisuseException</a></li>
        
          <li><a href="./SQLite3/NotADatabaseException.html">SQLite3::NotADatabaseException</a></li>
        
          <li><a href="./SQLite3/NotFoundException.html">SQLite3::NotFoundException</a></li>
        
          <li><a href="./SQLite3/PermissionException.html">SQLite3::PermissionException</a></li>
        
          <li><a href="./SQLite3/Pragmas.html">SQLite3::Pragmas</a></li>
        
          <li><a href="./SQLite3/ProtocolException.html">SQLite3::ProtocolException</a></li>
        
          <li><a href="./SQLite3/RangeException.html">SQLite3::RangeException</a></li>
        
          <li><a href="./SQLite3/ReadOnlyException.html">SQLite3::ReadOnlyException</a></li>
        
          <li><a href="./SQLite3/ResultSet.html">SQLite3::ResultSet</a></li>
        
          <li><a href="./SQLite3/SQLException.html">SQLite3::SQLException</a></li>
        
          <li><a href="./SQLite3/SchemaChangedException.html">SQLite3::SchemaChangedException</a></li>
        
          <li><a href="./SQLite3/Statement.html">SQLite3::Statement</a></li>
        
          <li><a href="./SQLite3/TooBigException.html">SQLite3::TooBigException</a></li>
        
          <li><a href="./SQLite3/Translator.html">SQLite3::Translator</a></li>
        
          <li><a href="./SQLite3/UnsupportedException.html">SQLite3::UnsupportedException</a></li>
        
          <li><a href="./SQLite3/Value.html">SQLite3::Value</a></li>
        
          <li><a href="./SQLite3/VersionProxy.html">SQLite3::VersionProxy</a></li>
        
          <li><a href="./String.html">String</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    
<h1>API Changes</h1>
<ul><li>
<p><a
href="SQLite3/Database.html#method-i-execute">SQLite3::Database#execute</a>
only accepts an array for bind parameters.</p>
</li><li>
<p><a href="SQLite3/ResultSet.html">SQLite3::ResultSet</a> used to query the
database for the first row, regardless of whether the user asked for it or
not.  I have removed that so that rows will not be returned until the user
asks for them.  This is a subtle but sometimes important change in
behavior.</p>

<p>83882d2208ed189361617d5ab8532a325aaf729d</p>
</li><li>
<p><a href="SQLite3/Database.html#method-i-trace">SQLite3::Database#trace</a>
now takes either a block or an object that responds to "call".  The
previous implementation passed around a VALUE that was cast to a void *. 
This is dangerous because the value could get garbage collected before the
proc was called.  If the user wants data passed around with the block, they
should use variables available to the closure or create an object.</p>
</li><li>
<p><a href="SQLite3/Statement.html#method-i-step">SQLite3::Statement#step</a>
automatically converts to ruby types, where before all values were
automatically yielded as strings.  This will only be a problem for people
who were accessing information about the database that wasn't previously
passed through the pure ruby conversion code.</p>
</li><li>
<p><a
href="SQLite3/Database.html#method-i-errmsg">SQLite3::Database#errmsg</a>
no longer takes a parameter to return error messages as UTF-16.  Do people
even use that?  I opt for staying UTF-8 when possible.  See
test_integration.rb test_errmsg_utf16</p>
</li><li>
<p>SQLite3::Database#authorize same changes as trace</p>
</li><li>
<p>test/test_tc_database.rb was removed because we no longer use the Driver
design pattern.</p>
</li></ul>

<h1>Garbage Collection Strategy</h1>

<p>All statements keep pointers back to their respective database connections.
The @connection instance variable on the Statement handle keeps the
database connection alive.  Memory allocated for a statement handler will
be freed in two cases:</p>
<ul><li>
<p>close is called on the statement</p>
</li><li>
<p>The <a href="SQLite3/Database.html">SQLite3::Database</a> object gets
garbage collected</p>
</li></ul>

<p>We can¡¯t free the memory for the statement in the garbage collection
function for the statement handler.  The reason is because there exists a
race condition.  We cannot guarantee the order in which objects will be
garbage collected.  So, it is possible that a connection and a statement
are up for garbage collection.  If the database connection were to be
free¡¯d before the statement, then boom.  Instead we¡¯ll be conservative and
free unclosed statements when the connection is terminated.</p>

  </div>

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>
</body>
</html>

